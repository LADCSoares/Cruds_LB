<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface|Work+Sans">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    
    <title>CRUD de Itens</title>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <style>
  
        .titulo {
         font-family: "Abril Fatface", sans-serif;
        }

        .input-field .prefix.active{
            color: black;
        }

        .ftabela{
            font-family: "Work Sans", sans-serif;   
        }

        .borda{
            margin-top: 3%;
            border: 5px solid;
        }

    </style>
</head>
<body>
    <h2 class="center-align titulo">CRUD de Itens</h2>
    <section class="container ">
        <div class="container col s6 offset-s3 borda orange lighten-5 ">
        <div class="row">
        <article class="col s6 offset-s3">
            <br><br><br>
                <form id="formItens" onsubmit="return salvarItem(event);">
                    <label for="nome">Nome:</label>
                    <input type="text" name="nome" required>
                    <label for="descricao">Descrição:</label>
                    <input type="text" name="descricao" required>
                    <label for="preco">Preço:</label>
                    <input type="text" name="preco" required>
                    <p class="center-align">
                        <button class="waves-effect waves-light btn #00695c teal darken-3 white-text   brown lighten-1" type="submit"><i class="material-icons left">done_outline</i> Cadastrar </button>
                    </p>
                </form>
            </article>
        </div>
    </div>
    <br>
    <br>
    <br>  
    <div class="row">
        <article class="col s10 offset-s1 ">      
                <table class="responsive-table striped ftabela" border="1">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Nome</th>
                            <th>Descrição</th>
                            <th>Preço</th>
                            <th colspan="2">Ações</th>
                        </tr>
                    </thead>
                    <tbody id="tabelaItens"></tbody>
                </table>
            </article>
        </div>

        <br> <br>
        <div id="modal-confirmacao" class="modal">
            <div class="modal-content">
                <h4>Confirmar Exclusão</h4>
                <p>Tem certeza que deseja excluir este item?</p>
            </div>
            <div class="modal-footer center">
                <button id="btn-sim" class="modal-close waves-effect waves-green btn-flat" onclick="excluir();">Sim</button>
                <a href="#!" class="modal-close waves-effect waves-red btn-flat">Não</a>
            </div>
        </div>
        

    <script>
        $(document).ready(function() {
            listarItens();
        });

        function listarItens() {
            $.ajax({
                url: 'listarItens.php',
                type: 'GET',
                dataType: 'json',
                success: function(data) {
                    exibirItens(data);
                },
                error: function(error) {
                    console.log(error);
                }
            });
        }

        function exibirItens(itens) {
            var tabela = $('#tabelaItens');
            tabela.empty();

            for (var i = 0; i < itens.length; i++) {
                var item = itens[i];
                var linha = $('<tr>');
                linha.append('<td>' + item.id + '</td>');
                linha.append('<td>' + item.nome + '</td>');
                linha.append('<td>' + item.descricao + '</td>');
                linha.append('<td>' + item.preco + '</td>');
                linha.append('<td><button onclick="editarItens(' + item.id + ')">Editar</button> | <button onclick="excluirItens(' + item.id + ')">Excluir</button></td>');

                tabela.append(linha);
            }
        }

        function salvarItem(event) {
            event.preventDefault();
            
            var formData = $('#formItens').serializeArray();
            var item = {};
            
            $.each(formData, function(i, field) {
                item[field.name] = field.value;
            });

            var url = item.id ? 'salvarItens.php' : 'salvarItens.php';

            $.ajax({
                url: url,
                type: item.id ? 'PUT' : 'POST',
                dataType: 'json',
                data: JSON.stringify(item),
                contentType: 'application/json',
                success: function(data) {
                    listarItens();
                    $('#formItens')[0].reset();
                },
                error: function(error) {
                    console.log(error);
                }
            });

            return false;
        }

        function editarItem(id) {
            $.ajax({
                url: 'listarItens.php?id=' + id,
                type: 'GET',
                dataType: 'json',
                success: function(data) {
                    preencherFormulario(data);
                },
                error: function(error) {
                    console.log(error);
                }
            });
        }

        function excluirItem(id) {
            $('#modal-confirmacao').modal('open');
            idExclusao = id;
            $.ajax({
                url: 'excluirItens.php?id=' + id,
                type: 'DELETE',
                dataType: 'json',
                success: function(data) {
                    listarItens();
                },
                error: function(error) {
                    console.log(error);
                }
            });
        }

        function excluir() {
        // Fecha o modal de confirmação
        $('#modal-confirmacao').modal('close');

        // Chama a função para excluir o item
        excluirItem(idExclusao);
    }

        function preencherFormulario(item) {
            $('input[name="id"]').val(item.id);
            $('input[name="nome"]').val(item.nome);
            $('input[name="descricao"]').val(item.descricao);
            $('input[name="preco"]').val(item.preco);
        }
    </script>
</body>
</html>
