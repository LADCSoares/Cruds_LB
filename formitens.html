<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0"/>
    <title>CRUD de Itens</title>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
</head>
<body>
    <h2>CRUD de Itens</h2>

    <form id="formItem" onsubmit="return salvarItem(event);">
        <label for="nome">Nome:</label>
        <input type="text" name="nome" required>
        <label for="descricao">Descrição:</label>
        <input type="text" name="descricao" required>
        <label for="preco">Preço:</label>
        <input type="text" name="preco" required>
        <button type="submit">Salvar</button>
    </form>

    <table border="1">
        <thead>
            <tr>
                <th>ID</th>
                <th>Nome</th>
                <th>Descrição</th>
                <th>Preço</th>
                <th colspan="2">Ações</th>
            </tr>
        </thead>
        <tbody id="tabelaItens"></tbody>
    </table>

    <script>
        $(document).ready(function() {
            listarItens();
        });

        function listarItens() {
            $.ajax({
                url: 'listarItens.php',
                type: 'GET',
                dataType: 'json',
                success: function(data) {
                    exibirItens(data);
                },
                error: function(error) {
                    console.log(error);
                }
            });
        }

        function exibirItens(itens) {
            var tabela = $('#tabelaItens');
            tabela.empty();

            for (var i = 0; i < itens.length; i++) {
                var item = itens[i];
                var linha = $('<tr>');
                linha.append('<td>' + item.id + '</td>');
                linha.append('<td>' + item.nome + '</td>');
                linha.append('<td>' + item.descricao + '</td>');
                linha.append('<td>' + item.preco + '</td>');
                linha.append('<td><button onclick="editarItem(' + item.id + ')">Editar</button> | <button onclick="excluirItem(' + item.id + ')">Excluir</button></td>');

                tabela.append(linha);
            }
        }

        function salvarItem(event) {
            event.preventDefault();
            
            var formData = $('#formItem').serializeArray();
            var item = {};
            
            $.each(formData, function(i, field) {
                item[field.name] = field.value;
            });

            var url = item.id ? 'salvarItens.php' : 'salvarItens.php';

            $.ajax({
                url: url,
                type: item.id ? 'PUT' : 'POST',
                dataType: 'json',
                data: JSON.stringify(item),
                contentType: 'application/json',
                success: function(data) {
                    listarItens();
                    $('#formItem')[0].reset();
                },
                error: function(error) {
                    console.log(error);
                }
            });

            return false;
        }

        function editarItem(id) {
            $.ajax({
                url: 'listarItens.php?id=' + id,
                type: 'GET',
                dataType: 'json',
                success: function(data) {
                    preencherFormulario(data);
                },
                error: function(error) {
                    console.log(error);
                }
            });
        }

        function excluirItem(id) {
            $.ajax({
                url: 'excluirItens.php?id=' + id,
                type: 'DELETE',
                dataType: 'json',
                success: function(data) {
                    listarItens();
                },
                error: function(error) {
                    console.log(error);
                }
            });
        }

        function preencherFormulario(item) {
            $('input[name="id"]').val(item.id);
            $('input[name="nome"]').val(item.nome);
            $('input[name="descricao"]').val(item.descricao);
            $('input[name="preco"]').val(item.preco);
        }
    </script>
</body>
</html>
